/*! 🌸 LOTUS GLASS - FEATURES JAVASCRIPT v6.0 | UI Components & Functionality | 2025 */
(function(window,document){'use strict';class LotusGlassApp{constructor(){this.isInitialized=false;this.components={};this.cart={items:[],total:0};this.wishlist=[];this.currentPage='home';this.init()}async init(){if(this.isInitialized)return;try{await this.initializeCore();this.initializePageComponents();this.setupGlobalEvents();this.initializeAnimations();this.setupPerformanceMonitoring();this.isInitialized=true;console.log('🌸 Lotus Glass Features v6.0 initialized')}catch(error){console.error('❌ Lotus Glass Features initialization failed:',error)}}async initializeCore(){this.initializeBootstrap();this.initializeTooltips();this.initializeSmoothScrolling();this.initializeLazyLoading();this.initializeHeader();this.initializeModals();this.initializeCart();this.initializeWishlist()}initializeBootstrap(){if(typeof bootstrap!=='undefined'){const tooltipTriggerList=[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));tooltipTriggerList.map(tooltipTriggerEl=>new bootstrap.Tooltip(tooltipTriggerEl));const popoverTriggerList=[].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));popoverTriggerList.map(popoverTriggerEl=>new bootstrap.Popover(popoverTriggerEl))}}initializeTooltips(){const tooltips=document.querySelectorAll('[title]');tooltips.forEach(tooltip=>{tooltip.addEventListener('mouseenter',this.showTooltip.bind(this));tooltip.addEventListener('mouseleave',this.hideTooltip.bind(this))})}showTooltip(event){const element=event.target;const title=element.getAttribute('title');if(title){const tooltipEl=document.createElement('div');tooltipEl.className='lotus-tooltip';tooltipEl.textContent=title;tooltipEl.style.cssText=`position:absolute;background:#333;color:white;padding:5px 10px;border-radius:4px;font-size:12px;z-index:1000;pointer-events:none;`;document.body.appendChild(tooltipEl);const rect=element.getBoundingClientRect();tooltipEl.style.left=rect.left+rect.width/2-tooltipEl.offsetWidth/2+'px';tooltipEl.style.top=rect.top-tooltipEl.offsetHeight-5+'px';element._tooltip=tooltipEl}}hideTooltip(event){const element=event.target;if(element._tooltip){document.body.removeChild(element._tooltip);delete element._tooltip}}initializeSmoothScrolling(){const links=document.querySelectorAll('a[href^="#"]');links.forEach(link=>{link.addEventListener('click',event=>{event.preventDefault();const targetId=link.getAttribute('href').substring(1);const targetElement=document.getElementById(targetId);if(targetElement){targetElement.scrollIntoView({behavior:'smooth',block:'start'})}})})}initializeLazyLoading(){if(window.LotusCore&&window.LotusCore.LazyLoader){console.log('Lazy loading initialized via LotusCore')}else{this.fallbackLazyLoading()}}fallbackLazyLoading(){const images=document.querySelectorAll('img[data-src]');const imageObserver=new IntersectionObserver((entries,observer)=>{entries.forEach(entry=>{if(entry.isIntersecting){const img=entry.target;img.src=img.dataset.src;img.classList.remove('lazy');observer.unobserve(img)}})});images.forEach(img=>imageObserver.observe(img))}initializeHeader(){const header=document.querySelector('.main-header');if(header){let lastScrollTop=0;const scrollThreshold=100;window.addEventListener('scroll',LotusCore.PerfUtils.throttle(()=>{const scrollTop=window.pageYOffset||document.documentElement.scrollTop;if(scrollTop>scrollThreshold){header.classList.add('scrolled')}else{header.classList.remove('scrolled')}if(scrollTop>lastScrollTop&&scrollTop>scrollThreshold){header.style.transform='translateY(-100%)'}else{header.style.transform='translateY(0)'}lastScrollTop=scrollTop<=0?0:scrollTop},100))}}initializeModals(){const modalTriggers=document.querySelectorAll('[data-modal-target]');modalTriggers.forEach(trigger=>{trigger.addEventListener('click',event=>{event.preventDefault();const modalId=trigger.getAttribute('data-modal-target');this.openModal(modalId)})});const modalCloses=document.querySelectorAll('[data-modal-close]');modalCloses.forEach(close=>{close.addEventListener('click',event=>{event.preventDefault();this.closeModal()})});document.addEventListener('keydown',event=>{if(event.key==='Escape'){this.closeModal()}})}openModal(modalId){const modal=document.getElementById(modalId);if(modal){modal.classList.add('show');document.body.style.overflow='hidden';modal.addEventListener('click',event=>{if(event.target===modal){this.closeModal()}})}}closeModal(){const activeModal=document.querySelector('.modal.show');if(activeModal){activeModal.classList.remove('show');document.body.style.overflow='';setTimeout(()=>{activeModal.style.display='none'},300)}}initializeCart(){this.loadCartFromStorage();this.updateCartUI();const addToCartButtons=document.querySelectorAll('.add-to-cart');addToCartButtons.forEach(button=>{button.addEventListener('click',event=>{event.preventDefault();const productId=button.getAttribute('data-product-id');const productName=button.getAttribute('data-product-name');const productPrice=parseFloat(button.getAttribute('data-product-price'));const productImage=button.getAttribute('data-product-image');this.addToCart({id:productId,name:productName,price:productPrice,image:productImage,quantity:1})})})}addToCart(product){const existingItem=this.cart.items.find(item=>item.id===product.id);if(existingItem){existingItem.quantity+=product.quantity}else{this.cart.items.push(product)}this.updateCartTotal();this.saveCartToStorage();this.updateCartUI();this.showCartNotification(product);LotusCore.EventBus.emit('cart:updated',{cart:this.cart,action:'add',product})}removeFromCart(productId){this.cart.items=this.cart.items.filter(item=>item.id!==productId);this.updateCartTotal();this.saveCartToStorage();this.updateCartUI();LotusCore.EventBus.emit('cart:updated',{cart:this.cart,action:'remove',productId})}updateCartQuantity(productId,quantity){const item=this.cart.items.find(item=>item.id===productId);if(item){if(quantity<=0){this.removeFromCart(productId)}else{item.quantity=quantity;this.updateCartTotal();this.saveCartToStorage();this.updateCartUI();LotusCore.EventBus.emit('cart:updated',{cart:this.cart,action:'update',productId,quantity})}}}updateCartTotal(){this.cart.total=this.cart.items.reduce((total,item)=>total+(item.price*item.quantity),0)}loadCartFromStorage(){const savedCart=LotusCore.StorageUtils.get('lotus_cart',{items:[],total:0});this.cart=savedCart;this.updateCartTotal()}saveCartToStorage(){LotusCore.StorageUtils.set('lotus_cart',this.cart)}updateCartUI(){const cartBadge=document.getElementById('cartBadge');const cartCount=document.querySelector('.cart-count');const totalItems=this.cart.items.reduce((total,item)=>total+item.quantity,0);if(cartBadge){cartBadge.textContent=totalItems;cartBadge.style.display=totalItems>0?'inline':'none'}if(cartCount){cartCount.textContent=totalItems}}showCartNotification(product){const notification=document.createElement('div');notification.className='cart-notification';notification.innerHTML=`<div class="notification-content"><i class="fas fa-check-circle"></i><span>${product.name} đã được thêm vào giỏ hàng</span></div>`;notification.style.cssText=`position:fixed;top:20px;right:20px;background:white;border:1px solid #ddd;border-radius:8px;padding:15px;box-shadow:0 4px 12px rgba(0,0,0,0.15);z-index:1000;transform:translateX(100%);transition:transform 0.3s ease;`;document.body.appendChild(notification);setTimeout(()=>notification.style.transform='translateX(0)',100);setTimeout(()=>{notification.style.transform='translateX(100%)';setTimeout(()=>document.body.removeChild(notification),300)},3000)}initializeWishlist(){this.loadWishlistFromStorage();this.updateWishlistUI();const wishlistButtons=document.querySelectorAll('.add-to-wishlist');wishlistButtons.forEach(button=>{button.addEventListener('click',event=>{event.preventDefault();const productId=button.getAttribute('data-product-id');const productName=button.getAttribute('data-product-name');const productPrice=parseFloat(button.getAttribute('data-product-price'));const productImage=button.getAttribute('data-product-image');if(this.isInWishlist(productId)){this.removeFromWishlist(productId)}else{this.addToWishlist({id:productId,name:productName,price:productPrice,image:productImage})}})})}addToWishlist(product){if(!this.isInWishlist(product.id)){this.wishlist.push(product);this.saveWishlistToStorage();this.updateWishlistUI();this.showWishlistNotification(product,'added');LotusCore.EventBus.emit('wishlist:updated',{wishlist:this.wishlist,action:'add',product})}}removeFromWishlist(productId){this.wishlist=this.wishlist.filter(item=>item.id!==productId);this.saveWishlistToStorage();this.updateWishlistUI();LotusCore.EventBus.emit('wishlist:updated',{wishlist:this.wishlist,action:'remove',productId})}isInWishlist(productId){return this.wishlist.some(item=>item.id===productId)}loadWishlistFromStorage(){this.wishlist=LotusCore.StorageUtils.get('lotus_wishlist',[])}saveWishlistToStorage(){LotusCore.StorageUtils.set('lotus_wishlist',this.wishlist)}updateWishlistUI(){const wishlistBadge=document.querySelector('.wishlist-count');const wishlistButtons=document.querySelectorAll('.add-to-wishlist');if(wishlistBadge){wishlistBadge.textContent=this.wishlist.length;wishlistBadge.style.display=this.wishlist.length>0?'inline':'none'}wishlistButtons.forEach(button=>{const productId=button.getAttribute('data-product-id');const isInWishlist=this.isInWishlist(productId);button.classList.toggle('active',isInWishlist);const icon=button.querySelector('i');if(icon){icon.className=isInWishlist?'fas fa-heart':'far fa-heart'}})}showWishlistNotification(product,action){const message=action==='added'?`${product.name} đã được thêm vào danh sách yêu thích`:`${product.name} đã được xóa khỏi danh sách yêu thích`;const notification=document.createElement('div');notification.className='wishlist-notification';notification.innerHTML=`<div class="notification-content"><i class="fas fa-heart"></i><span>${message}</span></div>`;notification.style.cssText=`position:fixed;top:20px;right:20px;background:white;border:1px solid #ddd;border-radius:8px;padding:15px;box-shadow:0 4px 12px rgba(0,0,0,0.15);z-index:1000;transform:translateX(100%);transition:transform 0.3s ease;`;document.body.appendChild(notification);setTimeout(()=>notification.style.transform='translateX(0)',100);setTimeout(()=>{notification.style.transform='translateX(100%)';setTimeout(()=>document.body.removeChild(notification),300)},3000)}initializePageComponents(){const currentPath=window.location.pathname;if(currentPath.includes('store')||currentPath.includes('product')){this.initializeProductComponents()}if(currentPath.includes('cart')){this.initializeCartPage()}if(currentPath.includes('checkout')){this.initializeCheckoutPage()}}initializeProductComponents(){const productImages=document.querySelectorAll('.product-image-gallery img');productImages.forEach(img=>{img.addEventListener('click',()=>{this.openImageModal(img.src)})});const quantityInputs=document.querySelectorAll('.quantity-input');quantityInputs.forEach(input=>{const minusBtn=input.parentElement.querySelector('.quantity-minus');const plusBtn=input.parentElement.querySelector('.quantity-plus');if(minusBtn){minusBtn.addEventListener('click',()=>{const currentValue=parseInt(input.value)||1;if(currentValue>1){input.value=currentValue-1}})}if(plusBtn){plusBtn.addEventListener('click',()=>{const currentValue=parseInt(input.value)||1;input.value=currentValue+1})}})}openImageModal(imageSrc){const modal=document.createElement('div');modal.className='image-modal';modal.innerHTML=`<div class="image-modal-content"><img src="${imageSrc}" alt="Product Image"><button class="image-modal-close">&times;</button></div>`;modal.style.cssText=`position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;z-index:1000;`;document.body.appendChild(modal);modal.addEventListener('click',event=>{if(event.target===modal||event.target.classList.contains('image-modal-close')){document.body.removeChild(modal)}})}initializeCartPage(){const cartItems=document.querySelectorAll('.cart-item');cartItems.forEach(item=>{const removeBtn=item.querySelector('.remove-item');const quantityInput=item.querySelector('.quantity-input');if(removeBtn){removeBtn.addEventListener('click',()=>{const productId=item.getAttribute('data-product-id');this.removeFromCart(productId)})}if(quantityInput){quantityInput.addEventListener('change',()=>{const productId=item.getAttribute('data-product-id');const quantity=parseInt(quantityInput.value);this.updateCartQuantity(productId,quantity)})}})}initializeCheckoutPage(){const checkoutForm=document.getElementById('checkoutForm');if(checkoutForm){checkoutForm.addEventListener('submit',this.handleCheckoutSubmit.bind(this))}}handleCheckoutSubmit(event){event.preventDefault();const formData=new FormData(event.target);const orderData={items:this.cart.items,total:this.cart.total,customer:{name:formData.get('name'),email:formData.get('email'),phone:formData.get('phone'),address:formData.get('address')},timestamp:Date.now()};console.log('Processing order:',orderData);this.processOrder(orderData)}processOrder(orderData){LotusCore.StorageUtils.set('lotus_last_order',orderData);this.cart={items:[],total:0};this.saveCartToStorage();this.updateCartUI();window.location.href='/order-success.html'}setupGlobalEvents(){document.addEventListener('click',this.handleGlobalClick.bind(this));document.addEventListener('keydown',this.handleGlobalKeydown.bind(this));window.addEventListener('resize',LotusCore.PerfUtils.debounce(this.handleResize.bind(this),250));window.addEventListener('scroll',LotusCore.PerfUtils.throttle(this.handleScroll.bind(this),100))}handleGlobalClick(event){if(event.target.matches('.dropdown-toggle')){event.preventDefault();this.toggleDropdown(event.target)}if(event.target.matches('[data-page]')){event.preventDefault();const page=event.target.getAttribute('data-page');this.navigateToPage(page)}}handleGlobalKeydown(event){if(event.key==='Escape'){this.closeAllDropdowns();this.closeModal()}}handleResize(){this.updateLayout()}handleScroll(){this.updateScrollPosition()}toggleDropdown(trigger){const dropdown=trigger.nextElementSibling;if(dropdown&&dropdown.classList.contains('dropdown-menu')){dropdown.classList.toggle('show')}}closeAllDropdowns(){const dropdowns=document.querySelectorAll('.dropdown-menu.show');dropdowns.forEach(dropdown=>dropdown.classList.remove('show'))}navigateToPage(page){console.log('Navigating to page:',page);this.currentPage=page;LotusCore.EventBus.emit('page:change',{page,timestamp:Date.now()})}updateLayout(){LotusCore.EventBus.emit('layout:update',{width:window.innerWidth,height:window.innerHeight})}updateScrollPosition(){LotusCore.EventBus.emit('scroll:update',{scrollY:window.scrollY})}initializeAnimations(){const animatedElements=document.querySelectorAll('[data-animate]');const animationObserver=new IntersectionObserver((entries)=>{entries.forEach(entry=>{if(entry.isIntersecting){const element=entry.target;const animation=element.getAttribute('data-animate');element.classList.add('animate-'+animation);animationObserver.unobserve(element)}})},{threshold:0.1});animatedElements.forEach(el=>animationObserver.observe(el))}setupPerformanceMonitoring(){if(window.LotusCore&&window.LotusCore.PerformanceMonitor){setInterval(()=>{const metrics=window.LotusCore.PerformanceMonitor.getMetrics();console.log('Performance metrics:',metrics)},30000)}}}window.LotusGlassApp=new LotusGlassApp();if(typeof module!=='undefined'&&module.exports){module.exports=LotusGlassApp}})(window,document);
